

let scoreBoard = {
  
};

// Î™®Îìà Ïä§ÏΩîÌîÑ Î≥ÄÏàò ÏÑ†Ïñ∏

let currentTurn = 0;
let currentTurn_1p = 0;
let currentTurn_2p = 0;

export function nextTurn() {
  currentTurn++;
  let turnMessage="";
  if (currentTurn % 2 === 1) { // ÌôÄÏàò ÌÑ¥
    currentTurn_1p++;
    document.getElementById("turnDisplay").textContent = currentTurn_1p;
    console.log("1P ÌÑ¥ Ïàò: ", currentTurn_1p);
    turnMessage="1P Ï∞®Î°ÄÏûÖÎãàÎã§";
  } else { // ÏßùÏàò ÌÑ¥
    currentTurn_2p++;
    document.getElementById("turnDisplay2").textContent = currentTurn_2p;
    console.log("2P ÌÑ¥ Ïàò: ", currentTurn_2p);
    turnMessage="2P Ï∞®Î°ÄÏûÖÎãàÎã§";
  }
  document.getElementById("turnMessage").textContent = turnMessage;
}
  

// üõë `savedScores`Îäî localStorageÏóêÏÑú Î∂àÎü¨ÏôÄ Ï†ÄÏû•
export let savedScores = JSON.parse(localStorage.getItem("savedScores")) || [];



// üü¢ Ï†êÏàò Î∂àÎü¨Ïò§Í∏∞ Ìï®Ïàò (ÏµúÍ∑º Ï†êÏàòÎßå Î∂àÎü¨Ïò§Í∏∞)
export function loadScores() {
  console.log("üîÑ loadScores() Ïã§ÌñâÎê®! (ÏµúÍ∑º Ï†êÏàòÎßå Î∂àÎü¨Ïò§Í∏∞)");
  let savedData = localStorage.getItem("savedScores");
  if (!savedData) {
    console.warn("‚ö†Ô∏è Ï†ÄÏû•Îêú Ï†êÏàòÍ∞Ä ÏóÜÏäµÎãàÎã§!");
    return;
  }
  let parsedData = JSON.parse(savedData);
  if (!Array.isArray(parsedData) || parsedData.length === 0) {
    console.warn("‚ö†Ô∏è Ï†ÄÏû•Îêú Ï†êÏàò ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§!");
    return;
  }
  // üî• Í∞ÄÏû• ÏµúÍ∑º Ï†êÏàòÎßå Í∞ÄÏ†∏Ïò§Í∏∞
  let latestScore = parsedData[parsedData.length - 1];
  console.log("‚úÖ Î∂àÎü¨Ïò® ÏµúÍ∑º Ï†êÏàò:", latestScore);

  // üõë Í∏∞Ï°¥ `savedScores` Î∞∞Ïó¥ ÎπÑÏö∞Í≥† ÏµúÍ∑º Ï†êÏàòÎßå Ï∂îÍ∞Ä
  savedScores.length = 0;
  savedScores.push(latestScore);

  console.log("‚úÖ `savedScores` ÏóÖÎç∞Ïù¥Ìä∏:", savedScores);
  // üü¢ Ï†êÏàò Î¶¨Ïä§Ìä∏Î•º HTML ÏöîÏÜåÏóê Ï∂îÍ∞Ä
  updateScoreDisplay();
}

// üü¢ Ï†êÏàò Î¶¨Ïä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò (ÏµúÍ∑º Ï†êÏàòÎßå ÌëúÏãú)
function updateScoreDisplay() {
    const displayId = currentTurn % 2 === 1 ? 'scoreDisplay' : 'scoreDisplay2';
    const scoreDisplay = document.getElementById(displayId);
    
    if (!scoreDisplay) {
      console.error(`‚ùå '${displayId}' ÏöîÏÜåÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏùå!`);
      return;
    }
    
    // üî• Í∏∞Ï°¥ Î¶¨Ïä§Ìä∏ Ï¥àÍ∏∞Ìôî
    scoreDisplay.innerHTML = '';
    
    // üîπ ÏµúÍ∑º Ï†êÏàòÎßå Î¶¨Ïä§Ìä∏Ïóê Ï∂îÍ∞Ä
    if (savedScores.length > 0) {
      const listItem = document.createElement('div');
      listItem.textContent = `üé≤ ÏµúÍ∑º Í≤åÏûÑ Ï†êÏàò: ${savedScores[savedScores.length - 1].join(', ')}`;
      scoreDisplay.appendChild(listItem);
    } else {
      scoreDisplay.textContent = "‚ö†Ô∏è Ï†ÄÏû•Îêú Ï†êÏàòÍ∞Ä ÏóÜÏäµÎãàÎã§.";
    }
    
    console.log(`‚úÖ ${displayId} Ï†êÏàò Î¶¨Ïä§Ìä∏ ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å! (ÏµúÍ∑º Ï†êÏàòÎßå ÌëúÏãú)`);
  }
  

// üü¢ Ï†ÄÏû•Îêú Ï†êÏàò ÌëúÏãú Ìï®Ïàò
export function displayScores() {
  const scoreDisplay = document.getElementById('scoreDisplay');
  scoreDisplay.innerHTML = 'Ï†ÄÏû•Îêú Ï†êÏàò: ' + savedScores.join(', ');
}




export function scoreCategory(category) {
  console.log("Original savedScores:", savedScores);
  let dice = savedScores[0];//ÎÇ¥Î∂Ä Î∞∞Ïó¥ÏùÑ Í∞ÄÏ†∏Ïò¥Ïò¥
  // Í∞ùÏ≤¥Ïùò 'value' ÏÜçÏÑ±Îßå Ï∂îÏ∂ú
  console.log("Extracted dice values:", dice);

  // savedScoresÍ∞Ä ÎπÑÏñ¥ÏûàÏúºÎ©¥ Îçî Ïù¥ÏÉÅ ÏßÑÌñâÌïòÏßÄ ÏïäÏùå
  if (!savedScores || savedScores.length === 0) {
    console.warn("‚ö†Ô∏è savedScores Î∞∞Ïó¥Ïù¥ ÎπÑÏñ¥ÏûàÏäµÎãàÎã§. Îçî Ïù¥ÏÉÅ ÏßÑÌñâÌïòÏßÄ ÏïäÏäµÎãàÎã§.");
    return;
  }

  if (category === "ones") {
    scoreBoard.ones = countNumbers(dice, 1) * 1;
  } else if (category === "twos") {
    scoreBoard.twos = countNumbers(dice, 2) * 2;
  } else if (category === "threes") {
    scoreBoard.threes = countNumbers(dice, 3) * 3;
  } else if (category === "fours") {
    scoreBoard.fours = countNumbers(dice, 4) * 4;
  } else if (category === "fives") {
    scoreBoard.fives = countNumbers(dice, 5) * 5;
  } else if (category === "sixes") {
    scoreBoard.sixes = countNumbers(dice, 6) * 6;
  } else if (category === "threeOfAKind") {
    if (hasSameValues(dice, 3)) {
      scoreBoard.threeOfAKind = dice.reduce((a, b) => a + b, 0);
    } else {
      scoreBoard.threeOfAKind = 0;
    }
  } else if (category === "fourOfAKind") {
    if (hasSameValues(dice, 4)) {
      scoreBoard.fourOfAKind = dice.reduce((a, b) => a + b, 0);
    } else {
      scoreBoard.fourOfAKind = 0;
    }
  } else if (category === "fullHouse") {
    if (isFullHouse(dice)) {
      scoreBoard.fullHouse = 25;
    } else {
      scoreBoard.fullHouse = 0;
    }
  } else if (category === "smallStraight") {
    if (isSmallStraight(dice)) {
      scoreBoard.smallStraight = 30;
    } else {
      scoreBoard.smallStraight = 0;
    }
  } else if (category === "largeStraight") {
    if (isLargeStraight(dice)) {
      scoreBoard.largeStraight = 40;
    } else {
      scoreBoard.largeStraight = 0;
    }
  } else if (category === "yahtzee") {
    if (hasSameValues(dice, 5)) {
      scoreBoard.yahtzee = 50;
    } else {
      scoreBoard.yahtzee = 0;
    }
  } else if (category === "chance") {
    scoreBoard.chance = dice.reduce((a, b) => a + b, 0);
  }
  //2P Ï†êÏàò Í≥ÑÏÇ∞

  if (category === "ones2") {
    scoreBoard.ones2 = countNumbers(dice, 1) * 1;
  } else if (category === "twos2") {
    scoreBoard.twos2 = countNumbers(dice, 2) * 2;
  } else if (category === "threes2") {
    scoreBoard.threes2 = countNumbers(dice, 3) * 3;
  } else if (category === "fours2") {
    scoreBoard.fours2 = countNumbers(dice, 4) * 4;
  } else if (category === "fives2") {
    scoreBoard.fives2 = countNumbers(dice, 5) * 5;
  } else if (category === "sixes2") {
    scoreBoard.sixes2 = countNumbers(dice, 6) * 6;
  } else if (category === "threeOfAKind2") {
    if (hasSameValues(dice, 3)) {
      scoreBoard.threeOfAKind2 = dice.reduce((a, b) => a + b, 0);
    } else {
      scoreBoard.threeOfAKind2 = 0;
    }
  } else if (category === "fourOfAKind2") {
    if (hasSameValues(dice, 4)) {
      scoreBoard.fourOfAKind2 = dice.reduce((a, b) => a + b, 0);
    } else {
      scoreBoard.fourOfAKind2 = 0;
    }
  } else if (category === "fullHouse2") {
    if (isFullHouse(dice)) {
      scoreBoard.fullHouse2 = 25;
    } else {
      scoreBoard.fullHouse2 = 0;
    }
  } else if (category === "smallStraight2") {
    if (isSmallStraight(dice)) {
      scoreBoard.smallStraight2 = 30;
    } else {
      scoreBoard.smallStraight2 = 0;
    }
  } else if (category === "largeStraight2") {
    if (isLargeStraight(dice)) {
      scoreBoard.largeStraight2 = 40;
    } else {
      scoreBoard.largeStraight2 = 0;
    }
  } else if (category === "yahtzee2") {
    if (hasSameValues(dice, 5)) {
      scoreBoard.yahtzee2 = 50;
    } else {
      scoreBoard.yahtzee2 = 0;
    }
  } else if (category === "chance2") {
    scoreBoard.chance2 = dice.reduce((a, b) => a + b, 0);
  }
  updateScoreBoard();
  disableCategoryButton(category);

  // Ï†êÏàò ÏÑ†ÌÉù ÌõÑ savedScores Î∞∞Ïó¥ ÎπÑÏö∞Í∏∞
  savedScores = [];
  localStorage.removeItem("savedScores");

}

export function updateScoreBoard() {
  document.getElementById("scoreOnes").textContent = scoreBoard.ones || "0";
  document.getElementById("scoreTwos").textContent = scoreBoard.twos || "0";
  document.getElementById("scoreThrees").textContent = scoreBoard.threes || "0";
  document.getElementById("scoreFours").textContent = scoreBoard.fours || "0";
  document.getElementById("scoreFives").textContent = scoreBoard.fives || "0";
  document.getElementById("scoreSixes").textContent = scoreBoard.sixes || "0";
  document.getElementById("scoreThreeOfAKind").textContent = scoreBoard.threeOfAKind || "0";
  document.getElementById("scoreFourOfAKind").textContent = scoreBoard.fourOfAKind || "0";
  document.getElementById("scoreFullHouse").textContent = scoreBoard.fullHouse || "0";
  document.getElementById("scoreSmallStraight").textContent = scoreBoard.smallStraight || "0";
  document.getElementById("scoreLargeStraight").textContent = scoreBoard.largeStraight || "0";
  document.getElementById("scoreYahtzee").textContent = scoreBoard.yahtzee || "0";
  document.getElementById("scoreChance").textContent = scoreBoard.chance || "0";

  // ÏÉÅÎã® ÏÑπÏÖò Ìï©Í≥Ñ Í≥ÑÏÇ∞
  let upperSectionSum =
    (scoreBoard.ones || 0) +
    (scoreBoard.twos || 0) +
    (scoreBoard.threes || 0) +
    (scoreBoard.fours || 0) +
    (scoreBoard.fives || 0) +
    (scoreBoard.sixes || 0);
  scoreBoard.upperSectionTotal = upperSectionSum;
  document.getElementById("upperSectionTotal").textContent = upperSectionSum;

  // Î≥¥ÎÑàÏä§ Í≥ÑÏÇ∞
  if (upperSectionSum >= 63) {
    scoreBoard.bonus = 35;
  } else {
    scoreBoard.bonus = 0;
  }
  document.getElementById("bonus").textContent = scoreBoard.bonus;

  // ÏÉÅÎã® ÏÑπÏÖò Ï¥ùÏ†ê Í≥ÑÏÇ∞ (Ìï©Í≥Ñ + Î≥¥ÎÑàÏä§)
  scoreBoard.upperSectionGrandTotal = upperSectionSum + scoreBoard.bonus;
  document.getElementById("upperSectionGrandTotal").textContent = scoreBoard.upperSectionGrandTotal;

  // ÌïòÎã® ÏÑπÏÖò Ìï©Í≥Ñ Í≥ÑÏÇ∞
  let lowerSectionSum =
    (scoreBoard.threeOfAKind || 0) +
    (scoreBoard.fourOfAKind || 0) +
    (scoreBoard.fullHouse || 0) +
    (scoreBoard.smallStraight || 0) +
    (scoreBoard.largeStraight || 0) +
    (scoreBoard.yahtzee || 0) +
    (scoreBoard.chance || 0);
  scoreBoard.lowerSectionTotal = lowerSectionSum;
  document.getElementById("lowerSectionTotal").textContent = lowerSectionSum;

  // ÏµúÏ¢Ö Ï†êÏàò Í≥ÑÏÇ∞
  scoreBoard.grandTotal = scoreBoard.upperSectionGrandTotal + scoreBoard.lowerSectionTotal;
  document.getElementById("grandTotal").textContent = scoreBoard.grandTotal;
  
  //2P Ï†êÏàò Í≥ÑÏÇ∞
  document.getElementById("scoreOnes2").textContent = scoreBoard.ones2 || "0";
  document.getElementById("scoreTwos2").textContent = scoreBoard.twos2 || "0";
  document.getElementById("scoreThrees2").textContent = scoreBoard.threes2 || "0";
  document.getElementById("scoreFours2").textContent = scoreBoard.fours2 || "0";
  document.getElementById("scoreFives2").textContent = scoreBoard.fives2 || "0";
  document.getElementById("scoreSixes2").textContent = scoreBoard.sixes2 || "0";
  document.getElementById("scoreThreeOfAKind2").textContent = scoreBoard.threeOfAKind2 || "0";
  document.getElementById("scoreFourOfAKind2").textContent = scoreBoard.fourOfAKind2 || "0";
  document.getElementById("scoreFullHouse2").textContent = scoreBoard.fullHouse2 || "0";
  document.getElementById("scoreSmallStraight2").textContent = scoreBoard.smallStraight2 || "0";
  document.getElementById("scoreLargeStraight2").textContent = scoreBoard.largeStraight2 || "0";
  document.getElementById("scoreYahtzee2").textContent = scoreBoard.yahtzee2 || "0";
  document.getElementById("scoreChance2").textContent = scoreBoard.chance2 || "0";

  // ÏÉÅÎã® ÏÑπÏÖò Ìï©Í≥Ñ Í≥ÑÏÇ∞
  let upperSectionSum2 =
    (scoreBoard.ones2 || 0) +
    (scoreBoard.twos2 || 0) +
    (scoreBoard.threes2 || 0) +
    (scoreBoard.fours2 || 0) +
    (scoreBoard.fives2 || 0) +
    (scoreBoard.sixes2 || 0);
  scoreBoard.upperSectionTotal2 = upperSectionSum2;
  document.getElementById("upperSectionTotal2").textContent = upperSectionSum2;

  // Î≥¥ÎÑàÏä§ Í≥ÑÏÇ∞
  if (upperSectionSum >= 63) {
    scoreBoard.bonus2 = 35;
  } else {
    scoreBoard.bonus2 = 0;
  }
  document.getElementById("bonus2").textContent = scoreBoard.bonus2;

  // ÏÉÅÎã® ÏÑπÏÖò Ï¥ùÏ†ê Í≥ÑÏÇ∞ (Ìï©Í≥Ñ + Î≥¥ÎÑàÏä§)
  scoreBoard.upperSectionGrandTotal2 = upperSectionSum2 + scoreBoard.bonus2;
  document.getElementById("upperSectionGrandTotal2").textContent = scoreBoard.upperSectionGrandTotal2;

  // ÌïòÎã® ÏÑπÏÖò Ìï©Í≥Ñ Í≥ÑÏÇ∞
  let lowerSectionSum2 =
    (scoreBoard.threeOfAKind2 || 0) +
    (scoreBoard.fourOfAKind2 || 0) +
    (scoreBoard.fullHouse2 || 0) +
    (scoreBoard.smallStraight2 || 0) +
    (scoreBoard.largeStraight2 || 0) +
    (scoreBoard.yahtzee2 || 0) +
    (scoreBoard.chance2 || 0);
    scoreBoard.lowerSectionTotal2 = lowerSectionSum2;
    document.getElementById("lowerSectionTotal2").textContent = lowerSectionSum2;
    
    // ÏµúÏ¢Ö Ï†êÏàò Í≥ÑÏÇ∞
    scoreBoard.grandTotal2 = scoreBoard.upperSectionGrandTotal2 + scoreBoard.lowerSectionTotal2;
    document.getElementById("grandTotal2").textContent = scoreBoard.grandTotal2;
  
}


function countNumbers(dice, number) {
  return dice.filter(die => die === number).length;
}

function hasSameValues(dice, count) {
  const counts = {};
  for (const die of dice) {
    counts[die] = (counts[die] || 0) + 1;
  }
  return Object.values(counts).some(c => c >= count);
}

function isFullHouse(dice) {
  const counts = {};
  for (const die of dice) {
    counts[die] = (counts[die] || 0) + 1;
  }
  const values = Object.values(counts);
  return values.includes(2) && values.includes(3);
}

function isSmallStraight(dice) {
  const uniqueDice = [...new Set(dice)].sort();
  const straight = [1, 2, 3, 4, 5, 6];
  for (let i = 0; i <= straight.length - 4; i++) {
    if (uniqueDice.join('').includes(straight.slice(i, i + 4).join(''))) {
      return true;
    }
  }
  return false;
}

function isLargeStraight(dice) {
  const uniqueDice = [...new Set(dice)].sort();
  const largeStraight1 = [1, 2, 3, 4, 5];
  const largeStraight2 = [2, 3, 4, 5, 6];
  return uniqueDice.join('') === largeStraight1.join('') || uniqueDice.join('') === largeStraight2.join('');
}

// Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº ÌôúÏÑ±Ìôî Ìï®Ïàò
function enableCategoryButtons() {
  const buttons = document.querySelectorAll('.button');
  buttons.forEach(button => {
    const category = button.id.replace('Button', '');
    button.disabled = scoreBoard[category] !== null;
  });
}

// Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº ÎπÑÌôúÏÑ±Ìôî Ìï®Ïàò
function disableCategoryButton(category) {
  document.getElementById(category).disabled = true;
}

function isGameOver() {
  return Object.values(scoreBoard).every(score => score !== null);
}

function calculateTotalScore() {
  let totalScore = Object.values(scoreBoard).reduce((a, b) => a + b, 0);
  alert(`Í≤åÏûÑ Ï¢ÖÎ£å! Ï¥ù Ï†êÏàò: ${totalScore}`);
}
